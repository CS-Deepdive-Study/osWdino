# CH01. 서론

# 운영체제란?

- 컴퓨터 하드웨어를 관리하는 소프트웨어
- 사용자와 하드웨어 사이의 중재자 역할 수행
- 운영체제의 가장 주요한 책임 - 자원`cpu, 메모리, I/O장치, 저장장치`을 프로그램에 할당하는 것
- 보편적인 정의는 없음. 일반적으로 커널, 시스템 프로그램, 미들웨어 프레임워크로 구성

# 컴퓨터 시스템의 구성

- 현대 시스템은 버스를 통해 연결된 여러 장치로 구성
- 장치마다 장치 드라이버 존재, 장치 드라이버가 장치 컨트롤러를 컨트롤, 인터페이스 제공
- 세 가지 주요한 부분이 존재. `인터럽트`, `저장장치 구조`, `입출력 구조`

## 인터럽트

- 컨트롤러가 장치 드라이버에게 작업을 완료했다는 사실을 알리는 방법
- 하드웨어에서는 항상 시스템 버스를 통해 CPU에 신호를 보내고, 인터럽트를 발생시킬 수 있음

### 인터럽트 구동 방식 입출력 사이클

- 전통적인 사이클
    1. CPU에서는 지속적으로 인터럽트 발생 여부를 확인
    2. 외부 하드웨어 컨트롤러에서는 준비가 완료되거나 에러가 발생했을 때 인터럽트 신호 발생
    3. CPU에서 인터럽트를 전달받으면, 현재 프로세스 상태를 저장하고, 제어를 인터럽트 핸들러에게 넘김
    4. 인터럽트 핸들러가 데이터를 처리하고 인터럽트에서 복귀
    5. 이전 프로세스 상태를 복구하고, 작업 재개
- 최신 운영 체제에서는 추가 기능이 필요함
    - 중요한 처리 중 인터럽트 처리 연기
    - 적절한 인터럽트 핸들러로 효율적 디스패치
    - 인터럽트의 우선순위를 구분하고 대응할 수 있도록 다단계 인터럽트 필요
- 해당 기능들은 인터럽트 컨트롤러 하드웨어에 의해 제공

## 저장장치 구조

- 프로그램 대부분을 메인 메모리(RAM)에서 가져옴
- RAM은 휘발성이기 때문에 펌웨어 형식의 부트스트랩 프로그램도 활용
- 모든 정보를 RAM에 담을 수 없기 때문에, 보조기억장치 활용
- 오랜 기간 유지하기 위해 3차 기억장치 활용
- 이러한 구조를 저장장치 계층 구조라고 하며, 계층별로 트레이드오프가 존재하기 때문에 적절히 사용하는 것이 중요

## 입출력 구조

- 인터럽트 기반 I/O도 존재하지만, 대량 데이터 이동에서는 오버헤드 과다
- 문제 해결을 위해 DMA 사용 - 버퍼/포인터/입출력 카운트 세팅 후 메모리에서 직접 버퍼 장치로 데이터 블록 전송

# 컴퓨터 시스템 구조

- 단일 처리기 - 단일 프로세서 사용, 현대에는 거의 x
- 다중 처리기 - 다중 프로세서 사용, SMP 사용
    - 코어마다 개별/로컬 캐시, 자체 레지스터 존재
    - 시간이 지나면서 로컬 L1 캐시, 두개 코어에서 공유되는 L2 캐시가 존재하는 형태로 진화
    - NUMA 구조 - CPU별로 로컬 메모리를 갖고, cpu의 로컬 버스를 통한 접근으로 성능 향상
- 클러스터형 시스템 - 병렬화

# 운영체제의 동작

1. 부트스트랩 구동
2. 부트스트랩이 운영체제 커널을 찾아 메모리에 적재
3. systemd 데몬을 시작으로 여러 시스템 데몬들을 시작
4. 부팅 완료, 이후 가능한 시나리오
    - 인터럽트 발생(ex. i/o, 트랩 등)을 통해 운영체제에 신호를 보냄
    - 시스템 콜을 통해 운영체제가 제공하는 서비스 수행

## 멀티프로그래밍, 멀티태스킹

- 멀티프로그래밍
    - 여러 프로세스를 메모리에 유지하면서 프로세스 선택 후 실행
    - 특정 프로세스가 대기해야 하는 경우 다른 프로세스로 전환
- 멀티태스킹
    - 여러 프로세스를 전환하면서 프로세스 실행
    - 전환이 자주 발생하여 빠른 응답 시간 제공
    - 메모리 관리 방식 필요

## 유저 모드, 커널 모드

- 모드 비트를 이용하여 구분
- 유저 모드 - 사용자 프로세스 실행하는 부분
- 트랩/인터럽트 발생 시 커널 모드로 전환(운영체제가 제어권을 얻음)
- 사용자에게 악영향을 미칠 수 있는 일부 명령을 특권 명령으로 지정하여 보호
- 유저가 커널 모드 요청을 위해 시스템 콜 사용
- 이때 시스템 콜은 소프트웨어 인터럽트처럼 처리됨
- 타이머 : 시스템 서비스 호출에 실패하여 제어가 운영체제로 복귀하지 못하는 경우를 막기 위한 장치

# 자원 관리

- CPU, 메모리, 저장소, I/O장치는 모두 운영체제가 관리하는 자원
- 프로세스 관리, 메모리 관리, 파일 시스템 관리, 저장장치 관리, 캐시 관리, 입출력 시스템 관리 등의 역할을 함

# 보안 및 보호

- 보호 - 사용자의 접근을 제어하는 기법
- 보안 - 내/외부 공격을 방어하는 기법

# 가상화

- 단일 컴퓨터의 하드웨어를 여러 실행 환경으로 추상화하여 개별 환경이 컴퓨터에서 실행되고 있다는 환상을 만드는 기술
- 운영체제가 다른 운영체제 내에서 하나의 응용 프로그램처럼 수행되도록 하는 기술

# 분산 시스템

- 물리적으로 떨어진 이기종 컴퓨터들의 집합, 네트워크로 연결됨
- 분산 운영체제 - 하나의 운영체제가 네트워크를 제어하는 것처럼 보이기 위해 여러 컴퓨터가 밀접 통신

# 커널 자료구조

- 리스트, 스택, 큐
- 트리
- 해시함수, 맵
- 비트맵

# 컴퓨팅 환경

- 전통적인 방법 - 오늘날 거의 희귀함
- 모바일 컴퓨팅 - 휴대용 시스템 기반 컴퓨팅, IEEE 802.11 무선 또는 휴대전화 데이터망 사용
- 클라이언트 서버 컴퓨팅 - 클라이언트가 필요로 하는 요청을 서버에서 수행 후 클라이언트에게 돌려주는 방식
- P2P - 개인 간 네트워킹, 분산형 피어를 이용하여 피어 간 통신 수행
- 클라우드 컴퓨팅 - 컴퓨터, 스토리지, 애플리케이션까지 모두 네트워크 서비스로 제공, 퍼블릭/프라이빗, 혼합형 존재
    - SaaS - 애플리케이션 단
    - PaaS - 데이터베이스 서버와 같은 애플리케이션에 맞게 준비된 소프트웨어 스택
    - IaaS - 일반적인 서버 혹은 저장장치
- 실시간 임베디드 시스템 - 실시간 운영체제 수행

# 오픈소스 OS

- 무료로 사용, 재배포 및 수정 가능
- GNU/Linux, FreeBSD, Solaris 존재

# 인터럽트 종류

- 외부 인터럽트
    - 전원 이상 인터럽트 - 정전, 전원 이상
    - 기계 착오 인터럽트 - CPU의 기능적인 오류 동작
    - 외부 신호 인터럽트 - 타이머에 의해 규정된 시간을 알리는 경우(타이머 인터럽트), 인터럽트키를 누른 경우, 외부 장치로부터 인터럽트 요청이 있는 경우
    - 입출력 인터럽트 - 입출력장치가 전송을 요구하거나 전송이 끝났음을 알릴 때, 입출력 데이터에 오류가 발생했을 때
- 내부 인터럽트(트랩)
    - 프로그램 검사 인터럽트 - Divided by Zero, Overflow, Underflow, 명령어 오사용, NPE등 프로그램 상 오류가 발생했을 때
- 소프트웨어 인터럽트
    - 프로그램 처리 중 명령의 요청에 따라 발생한 인터럽트
    - SVC 인터럽트 - 사용자가 SVC(SuperVisor Call) 명령을 써서 의도적으로 호출한 경우를 의미
    복잡한 입출력 처리하거나, 기억장치 할당, 오퍼레이터와 대화를 하는 경우 발생