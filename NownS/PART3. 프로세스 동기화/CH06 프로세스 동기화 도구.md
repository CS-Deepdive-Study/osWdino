# CH06. 프로세스 동기화 도구

# 협력적 프로세스

- 실행 중인 다른 프로세스의 실행에 영향을 주거나 영향받는 프로세스
- 논리 주소 공간을 공유하거나, 공유 메모리, 메시지 전달로 데이터 공유
- 동시 접근으로 인한 데이터 일관성 망치는 문제 존재

## 레이스 컨디션

- 여러 개의 프로세스가 동일한 자료를 접근하여 조작하고, 그 실행 결과가 접근이 발생한 특정 순서에 의존하는 상황
- 경쟁 상황에서 보호하기 위해 한 순간에 하나의 프로세스만이 자원을 조작하도록 보장해야 함

# 임계 구역 문제

- 임계 구역(Critical Section) : 다른 프로세스와 공유하는 데이터
    - 진입 구역, 퇴출 구역, 나머지 구역으로 이루어 짐
- 해결 방안
    - 상호 배제 - 특정 프로세스가 자신의 임계 구역에서 실행되면, 다른 프로세스는 진입할 수 없다
    - 진행 - 진입하려고 하는 프로세스만 있다면, 다른 구역에서 실행 중이지 않은 프로세스만 다음에 누가 그 임계 구역으로 진입할 수 있는지를 결정하는 데 참여할 수 있으며, 선택은 무한정 대기될 수 없다
    - 한정된 대기 - 프로세스가 자신의 임계 구역에 진입하려는 요청을 한 후부터 그 요청이 허용될 때까지 다른 프로세스들이 그들 자신의 임계구역에 진입하도록 허용하는 횟수에 한계가 있어야 한다.
- 운영체제에서의 접근법
    - 선점형 커널 - 커널 모드에서 수행되는 동안 선점 허용
    - 비선점형 커널 - 커널을 빠져나가거나 블락될때까지, 양보할 때까지 계속 수행

# Peterson의 해결 방안

- 임계 구역에 대한 고전적인 해결 방안
- 단순히 두 개의 프로세스가 두 개의 데이터 항목을 공유
    - int turn, boolean flag[2]
    - turn은 진입 순번, flag는 프로세스가 임계구역을 진입할 준비가 완료되었다는 뜻
- 스레드의 순서 보장이 불가능하다는 문제 때문에 일관성이 깨질 수 있음

# 하드웨어 지원

- 메모리 장벽 - 후속 연산 이전에 모든 적재/저장이 완료되도록 확인
- 하드웨어 명령어
    - test_and_set()
    - compare_and_swap()
    - 원자적으로 구성되어 있음
- atomic 변수
    - 기본 데이터 유형에 대한 원자적 연산 제공
    - 공유 데이터 한 개의 갱신에만 제한됨

# Mutex

- acquire() 함수로 락 획득, release()로 락 반환
- 불린 변수 available을 이용하여 락의 가용 여부 확인
- busy-waiting(스핀락) - 임계 구역에 들어가기 위해서 acquire 반복 실행

# 세마포어

- 세마포어 S 라는 정수 변수를 활용
- wait(), signal()을 이용
- 카운팅 세마포어 - 자원의 크기, 이진 세마포어 - 뮤텍스처럼 동작

# 모니터

- 동기화 도구들을 통합한 고급 언어 구조물
- 상호 배제를 제공해주는 추상 자료형
- 모니터 내부에 항상 하나의 프로세스만 활성화되도록 보장해 줌 - 프로그래머들이 명시적으로 코딩할 필요가 없음